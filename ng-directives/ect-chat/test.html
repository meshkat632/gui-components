<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <!--
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    -->

    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>

    <!--<script src="http://meshkat632.github.io/gui-components/ect-choose-file-button/ect-choose-file-button.js"></script>-->
    <link rel="stylesheet" href="ect-chat.css">
    <link rel="stylesheet" href="ect-message.css">
    <script src="ect-file-sender.js"></script>
    <script src="ect-file-transfer.js"></script>
    <script src="ect-choose-file-button.js"></script>
    <script src="ect-message.js"></script>
    <script src="ect-chat.js"></script>


        <script>

            window.getTetemplateUrl = function(name){
                console.log('getTetemplateUrl for name   :', name);
                if("ect-chat-new.html" == name) return "ect-chat-new.html";
                if("ect-message.html" == name) return "ect-message.html";
                if("ect-choose-file-button.html"== name) return "ect-choose-file-button.html";
                if("ect-file-transfer.html" == name) return "ect-file-transfer.html";
                if("ect-file-sender.html" == name) return "ect-file-sender.html";


                console.error('template not found for name:',name);
            };


        angular.module('myApp',['ect.directives.ectChooseFileButton','ect.directives.ectChat']).controller('chatViewController', ['$scope', '$interval','$window','$timeout', function ($scope, $interval, $window,$timeout) {

            /*
            $window.getTetemplateUrl = function(name){
                console.log('getTetemplateUrl for name', name);
                return name;
            };
            */
            $scope.messages = [
                { from:'Alice', msg:{ type:'CHAT', text:'hello from Alice'}},
                { from:'Bob', msg:{ type:'CHAT', text:'hello Alice how are you?'}},
                { from:'Bob', msg:{ type:'CHAT', text:'Are you free'}}
            ];

            $scope.sendMessage = function(message){
                console.log('page sendMessage', message)
                $scope.messages.push(message);
            };

            $scope.sendFile = function(file, fileTransferListener){
                console.log('page sendFile', file, fileTransferListener);
                fileTransferListener.onEstablished();
                setTimeout(function(){
                    fileTransferListener.onEstablished();
                    setTimeout(function(){
                        fileTransferListener.onStateChanged('SENDING');
                        setTimeout(function(){
                            fileTransferListener.onProgress(file.size/2,file.size);
                            setTimeout(function(){
                                fileTransferListener.onProgress(file.size,file.size);
                            },2000);
                        },2000);

                    },2000);
                },2000);
            };

        }]);

    </script>
    <style>
        .btn-file {
            position: relative;
            overflow: hidden;
        }
        .btn-file input[type=file] {
            position: absolute;
            top: 0;
            right: 0;
            min-width: 100%;
            min-height: 100%;
            font-size: 100px;
            text-align: right;
            filter: alpha(opacity=0);
            opacity: 0;
            outline: none;
            background: white;
            cursor: inherit;
            display: block;
        }
        .chatContainer{
            width: 400px;
            height: 400px;


            /*
            border: 1px solid red;
            border: 2px solid red;
            box-sizing: border-box;
            */
        }
    </style>
</head>
<body >
<!--<ect-file-sender></ect-file-sender>-->
<div ng-app='myApp' ng-controller="chatViewController">
    <div class="chatContainer">
        <ect-chat messages="messages" on-send-message="sendMessage(message)" on-send-file="sendFile(file, fileTransferListener)"></ect-chat>
    </div>
    <!--
    <ect-chat messages="messages" on-send-message="sendMessage(message)"></ect-chat>
    -->
    <!--
    <ect-choose-file-button on-select="fileSelected(files)" multiple>
        <button type="file" class="btn btn-sm">
            Browse
            <span class="glyphicon glyphicon-print"></span>
        </button>
    </ect-choose-file-button>
    <ect-choose-file-button on-select="fileSelected(files)" multiple>
        <button type="file" class="btn btn-sm">
            <span class="glyphicon glyphicon-print"></span>
        </button>
    </ect-choose-file-button>
    <ect-choose-file-button on-select="fileSelected(files)" multiple>
        Browse
        <span class="glyphicon glyphicon-print"></span>
    </ect-choose-file-button>
    -->
</div>
</body>
</html>
